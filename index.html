<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My e-Challan</title>
    <style>
        body {
            background-color: #FFA500; /* Bright orange background */
            color: #FFD700; /* Gold text color */
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .container {
            background-color: #FF8C00; /* Darker orange for the main box */
            padding: 20px;
            border: 2px solid #FFD700; /* Gold border */
            max-width: 800px;
            margin: 0 auto; /* Centers the container */
            border-radius: 5px; /* Rounded corners */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); /* Subtle shadow */
        }
        .note {
            color: #FF4500; /* Reddish-orange for warnings */
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 10px;
            background-color: rgba(255, 69, 0, 0.1); /* Light red background */
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #FFD700;
            border-radius: 5px;
        }
        .image {
            text-align: center;
            margin-bottom: 15px;
        }
        .item {
            margin: 10px 0;
            font-size: 1.1rem;
            display: flex;
            flex-direction: column; /* Stack label and value */
        }
        .label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .value {
            padding-left: 20px; /* Indent value from label */
        }
        .expired {
            color: #FF4500;
            font-weight: bold;
        }
        .url {
            text-align: center;
            margin: 10px 0;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <p class="note">Note: The Information mentioned in e-Challan, Such as (Validity and Vehicle No.) should be matched with the information mentioned in the https://geologymining.jk.gov.in/ which can be seen after scanning the QR code encrypted on e-Challan.<br>सूचना: ई-चालान में उल्लिखित जानकारी, जैसे (वैधता और वाहन संख्या) का मिलान https://geologymining.jk.gov.in/ में उल्लिखित जानकारी से किया जाना चाहिए, जिसे ई-चालान पर एन्क्रिप्ट किए गए क्यूआर कोड को स्कैन करने के बाद देखा जा सकता है।</p>
        <div class="section">
            <div class="image">
                <img src="image1.jpeg" alt="e-Challan QR Code" style="max-width: 100%; height: auto;">
            </div>
            <div class="item"><span class="label">e-Challan valid or expired:</span><span class="value" id="validityStatus"></span></div>
            <div class="item"><span class="label">इचलान की अवधि समाप्त हो गई है:</span><span class="value" id="validityStatusHindi"></span></div>
            <div class="url">URL: <a href="https://geologymining.jk.gov.in/" style="color: #FFD700; text-decoration: underline;">https://geologymining.jk.gov.in/</a></div>
            <div class="item"><span class="label">Challan No.:</span><span class="value" id="challanNo"></span></div>
        </div>
        <div class="section" id="detailsSection">
            <div class="item"><span class="label">Name & Location of Seller:</span><span class="value" id="seller"></span></div>
            <div class="item"><span class="label">Validity:</span><span class="value" id="validity"></span></div>
            <div class="item"><span class="label">Route of the Transportation:</span><span class="value" id="route"></span></div>
            <div class="item"><span class="label">Vehicle no.:</span><span class="value" id="vehicle"></span></div>
            <div class="item"><span class="label">Name & Address of Consignee:</span><span class="value" id="consignee"></span></div>
            <div class="item"><span class="label">Mineral:</span><span class="value" id="mineral"></span></div>
        </div>
    </div>
    <script>
        // Function to calculate validity (5 hours from Issued At) and check if expired
        function getValidityAndExpiration(issuedAt) {
            const currentDate = new Date('2025-10-25T02:27:00+05:30'); // October 25, 2025, 2:27 AM IST
            if (!issuedAt || issuedAt.trim() === '') return { validityRange: 'N/A', isExpired: '' };
            const issuedDate = new Date(issuedAt.replace(/(\d{2})-(\d{2})-(\d{4})\s(\d{2}):(\d{2})/, '$2/$1/$3 $4:$5'));
            if (isNaN(issuedDate.getTime())) return { validityRange: 'अमान्य तिथि', isExpired: '' };
            const validUntil = new Date(issuedDate.getTime() + 5 * 60 * 60 * 1000); // Add 5 hours
            const validityRange = `${issuedAt} से ${validUntil.toLocaleString('en-IN', { timeZone: 'Asia/Kolkata', hour12: true })} तक`;
            const isExpired = validUntil < currentDate ? ' <span class="expired">(समाप्त)</span>' : '';
            return { validityRange, isExpired, validUntil };
        }

        // Fetch and display CSV data
        fetch('data.csv')
            .then(response => {
                if (!response.ok) {
                    throw new Error('CSV file not found or inaccessible. Please ensure "data.csv" is in the repository root and the site has deployed (check https://github.com/yourusername/e-chalaan/actions).');
                }
                return response.text();
            })
            .then(data => {
                const rows = data.trim().split('\n').slice(1); // Skip header row
                rows.forEach(row => {
                    if (!row || row.trim() === '') return; // Skip completely empty or blank rows
                    const cols = row.split(',');
                    if (cols.length < 10) return; // Ensure all fields exist (10 columns)

                    const [code, status, challanNo, vehicle, driver, quantity, route, gst, amount, issuedAt] = cols;
                    const isValid = status && status.toLowerCase() === 'published'; // Assume "published" means valid
                    const { validityRange, isExpired } = getValidityAndExpiration(issuedAt || '');

                    // Set validity status
                    document.getElementById('validityStatus').textContent = isValid ? 'Valid' : 'Expired';
                    document.getElementById('validityStatusHindi').textContent = isValid ? 'वैध' : 'इचलान की अवधि समाप्त हो गई है';

                    // Set details from CSV
                    document.getElementById('challanNo').textContent = challanNo || 'N/A';
                    document.getElementById('seller').textContent = `M/s S.K. Stone Crusher Pandori, Kathua`; // Static for now
                    document.getElementById('validity').textContent = validityRange + (isExpired || '');
                    document.getElementById('route').textContent = `Source ${route || 'N/A'}-GOOND-NAGRI-LAKHANPUR Destination FIROZPUR [SAKTACHAK CAMP]`;
                    document.getElementById('vehicle').textContent = vehicle || 'N/A';
                    document.getElementById('consignee').textContent = `MEGHA ENGINEERING INFRASTRUCTURE LTD. THROUGH SHIV TRADING CO., SAKTACHAK`; // Static for now
                    document.getElementById('mineral').textContent = `Aggregate (Crushed Bajri) (06-75 mm) (48 MT)`; // Static for now
                });
            })
            .catch(error => {
                console.error('Error fetching CSV:', error);
                document.getElementById('detailsSection').innerHTML = `<p class="note">डेटा लोड करने में त्रुटि। कंसोल जांचें: ${error.message}</p>`;
            });
    </script>
</body>
</html>
